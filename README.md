# Permission API

æƒé™ç®¡ç†ç³»ç»Ÿ - åŸºäºRustå’ŒSeaORMæ„å»ºçš„ç°ä»£åŒ–æƒé™ç®¡ç†API

## é¡¹ç›®ç‰¹æ€§

- ğŸ” åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)
- ğŸš€ é«˜æ€§èƒ½å¼‚æ­¥API
- ğŸ›¡ï¸ å®‰å…¨çš„èº«ä»½éªŒè¯å’Œæˆæƒ
- ğŸ“Š å®Œæ•´çš„ç”¨æˆ·ã€è§’è‰²ã€èœå•ç®¡ç†
- ğŸ§ª å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–
- ğŸ³ Dockeræ”¯æŒ
- ğŸ“ è‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£

## å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨Makefileï¼ˆæ¨èï¼‰

```bash
# æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤
make help

# å®‰è£…ä¾èµ–å¹¶æ„å»ºé¡¹ç›®
make install

# è¿è¡Œæµ‹è¯•
make test

# è¿è¡Œåº”ç”¨
make run

# å¼€å‘æ¨¡å¼è¿è¡Œï¼ˆå¸¦è°ƒè¯•æ—¥å¿—ï¼‰
make dev

# ä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥
make fmt
make lint

# å®Œæ•´æ„å»ºæµç¨‹
make all
```

### æ‰‹åŠ¨æ„å»º

```bash
# å®‰è£…ä¾èµ–
cargo build

# è¿è¡Œæµ‹è¯•
cargo test

# è¿è¡Œåº”ç”¨
cargo run
```

## é¡¹ç›®ç»“æ„

```
permission-api/
â”œâ”€â”€ Cargo.toml              # å·¥ä½œç©ºé—´é…ç½®
â”œâ”€â”€ Makefile                # æ„å»ºå’Œå¼€å‘å·¥å…·
â”œâ”€â”€ Dockerfile              # Dockeré…ç½®
â”œâ”€â”€ crates/
â”‚   â”œâ”€â”€ app/               # æ ¸å¿ƒåº”ç”¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/ # APIæ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ entity/     # æ•°æ®åº“å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ service/    # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â””â”€â”€ tests.rs    # å•å…ƒæµ‹è¯•
â”‚   â”‚   â””â”€â”€ Cargo.toml
â”‚   â””â”€â”€ utils/              # å·¥å…·æ¨¡å—
â”œâ”€â”€ sql/                    # æ•°æ®åº“è„šæœ¬
â””â”€â”€ src/
    â””â”€â”€ main.rs            # åº”ç”¨å…¥å£
```

## å¼€å‘å·¥å…·

### Makefileå‘½ä»¤

#### æ„å»ºå‘½ä»¤
- `make build` - æ„å»ºé¡¹ç›®
- `make build-release` - æ„å»ºå‘å¸ƒç‰ˆæœ¬
- `make clean` - æ¸…ç†æ„å»ºæ–‡ä»¶

#### æµ‹è¯•å‘½ä»¤
- `make test` - è¿è¡Œæ‰€æœ‰æµ‹è¯•
- `make test-app` - è¿è¡Œapp crateæµ‹è¯•
- `make test-verbose` - è¿è¡Œè¯¦ç»†æµ‹è¯•
- `make test-coverage` - ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

#### ä»£ç è´¨é‡å‘½ä»¤
- `make check` - ä»£ç æ£€æŸ¥
- `make fmt` - æ ¼å¼åŒ–ä»£ç 
- `make fmt-check` - æ£€æŸ¥ä»£ç æ ¼å¼
- `make lint` - è¿è¡Œclippyæ£€æŸ¥
- `make lint-fix` - è‡ªåŠ¨ä¿®å¤clippyé—®é¢˜

#### è¿è¡Œå‘½ä»¤
- `make run` - è¿è¡Œåº”ç”¨
- `make dev` - å¼€å‘æ¨¡å¼è¿è¡Œ
- `make install` - å®‰è£…ä¾èµ–

#### Dockerå‘½ä»¤
- `make docker-build` - æ„å»ºDockeré•œåƒ
- `make docker-run` - è¿è¡ŒDockerå®¹å™¨
- `make docker-clean` - æ¸…ç†Dockeré•œåƒ

#### ç»„åˆå‘½ä»¤
- `make all` - å®Œæ•´æ„å»ºæµç¨‹
- `make pre-commit` - æäº¤å‰æ£€æŸ¥
- `make ci` - CIæ£€æŸ¥

### å¼€å‘å·¥å…·å®‰è£…

```bash
# å®‰è£…æ‰€æœ‰å¼€å‘å·¥å…·
make install-tools
```

è¿™å°†å®‰è£…ï¼š
- `cargo-tarpaulin` - æµ‹è¯•è¦†ç›–ç‡å·¥å…·
- `cargo-audit` - å®‰å…¨å®¡è®¡å·¥å…·
- `cargo-outdated` - ä¾èµ–æ›´æ–°æ£€æŸ¥å·¥å…·

## æµ‹è¯•

é¡¹ç›®ä½¿ç”¨SQLiteå†…å­˜æ•°æ®åº“è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œç¡®ä¿æµ‹è¯•çš„å¿«é€Ÿæ€§å’Œéš”ç¦»æ€§ã€‚

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œapp crateæµ‹è¯•
make test-app

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
make test-coverage
```

### æµ‹è¯•è¦†ç›–èŒƒå›´

- âœ… ç”¨æˆ·æœåŠ¡ (6ä¸ªæµ‹è¯•)
- âœ… è§’è‰²æœåŠ¡ (5ä¸ªæµ‹è¯•)
- âœ… èœå•æœåŠ¡ (5ä¸ªæµ‹è¯•)
- âœ… æ•°æ®åº“é…ç½® (1ä¸ªæµ‹è¯•)

## Dockeræ”¯æŒ

```bash
# æ„å»ºDockeré•œåƒ
make docker-build

# è¿è¡ŒDockerå®¹å™¨
make docker-run

# æ¸…ç†Dockeré•œåƒ
make docker-clean
```

## é…ç½®

### æ•°æ®åº“é…ç½®

é¡¹ç›®æ”¯æŒå¤šç§æ•°æ®åº“é…ç½®ï¼Œé»˜è®¤ä½¿ç”¨SQLiteè¿›è¡Œå¼€å‘ã€‚

### ç¯å¢ƒå˜é‡

- `RUST_LOG` - æ—¥å¿—çº§åˆ« (debug, info, warn, error)
- `DATABASE_URL` - æ•°æ®åº“è¿æ¥URL

## APIæ–‡æ¡£

å¯åŠ¨åº”ç”¨åï¼Œè®¿é—®ä»¥ä¸‹åœ°å€æŸ¥çœ‹APIæ–‡æ¡£ï¼š

- Swagger UI: http://localhost:8080/swagger
- OpenAPI JSON: http://localhost:8080/apidoc/openapi.json

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

é¡¹ç›®ä½¿ç”¨ä»¥ä¸‹å·¥å…·ç¡®ä¿ä»£ç è´¨é‡ï¼š

- `rustfmt` - ä»£ç æ ¼å¼åŒ–
- `clippy` - ä»£ç æ£€æŸ¥
- `cargo-audit` - å®‰å…¨å®¡è®¡

### æäº¤å‰æ£€æŸ¥

```bash
# è¿è¡Œå®Œæ•´çš„æäº¤å‰æ£€æŸ¥
make pre-commit
```

è¿™å°†æ‰§è¡Œï¼š
1. ä»£ç æ ¼å¼åŒ–
2. ä»£ç æ£€æŸ¥
3. è¿è¡Œæµ‹è¯•

### CI/CD

é¡¹ç›®åŒ…å«CIé…ç½®ï¼Œç¡®ä¿ä»£ç è´¨é‡ï¼š

```bash
# è¿è¡ŒCIæ£€æŸ¥
make ci
```

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·ç¡®ä¿ï¼š

1. è¿è¡Œ `make pre-commit` é€šè¿‡æ‰€æœ‰æ£€æŸ¥
2. æ·»åŠ é€‚å½“çš„æµ‹è¯•
3. æ›´æ–°ç›¸å…³æ–‡æ¡£

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–Pull Requestã€‚
